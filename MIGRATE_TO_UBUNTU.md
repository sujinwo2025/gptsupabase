MIGRATE_TO_UBUNTU.md

Purpose
- This document explains how to migrate the Groq project from local development to an Ubuntu 18.04+ or Debian 9+ server.

Prerequisites
- A target Ubuntu server with SSH access and a non-root sudo-enabled user.
- DNS A (and/or AAAA) records for `file.bytrix.my.id` and `www.file.bytrix.my.id` pointing to the server's public IP address.
- A copy of the project files (via git clone or rsync).
- A configured `.env` with production values for S3/Supabase/GPT credentials and `DOMAIN=file.bytrix.my.id` and `EMAIL=you@yourdomain`.

Quick Steps
1. SSH to server and run the included deploy script:
   sudo bash deploy-ubuntu.sh --repo /opt/groq --git <git_repo_url> --env /path/to/.env

2. Verify stack:
   sudo systemctl status groq-app
   docker ps
   docker compose -f /opt/groq/docker-compose.yml logs -f

3. Ensure DNS is set and wait for Caddy/Certbot to obtain certificates. If DNS not configured, stack will use fallback self-signed certs placed in `ssl/letsencrypt/live/<domain>/`.

Detailed Notes
- Docker & Compose:
  - The script installs Docker from Docker's official repository and the `docker-compose` plugin. It enables and starts the Docker daemon.
  - The script uses `docker compose` (plugin) commands. If you prefer the legacy `docker-compose` binary, install it and update the systemd unit accordingly.

- Systemd service:
  - The script creates a `groq-app.service` systemd unit which runs `docker compose up -d` and ensures the stack is started after reboot.

- Environment variables:
  - Place sensitive config in the `.env` file at the project root. The `.env` must include `DOMAIN` (FQDN without protocol) and `EMAIL` (for certificate registration).

- SSL Certificates:
  - Caddy and Certbot in the stack attempt to provision Let's Encrypt certificates automatically. This requires DNS to point to the server's IP.
  - If DNS does not point to the server yet, the stack will use a self-signed certificate automatically generated by the certbot entrypoint scripts, but browsers will show warnings until real certs are issued.

- Troubleshooting:
  - If Caddy fails with "DNS problem: NXDOMAIN" ensure your DNS A/AAAA records exist and propagated.
  - If Nginx fails to start due to missing cert files, check `ssl/letsencrypt/live/<domain>/` and the entrypoint logs.
  - If API container shows `unhealthy`, check the healthcheck in `docker-compose.yml` and ensure the app listens on `127.0.0.1:3000` for internal checks.

- Post-migration checklist:
  - Update DNS records if needed.
  - Verify Supabase and S3 credentials work from server.
  - Configure firewall to allow ports 80 and 443.
  - Enable automatic renewals (certbot/caddy already attempt this) and monitor logs.

